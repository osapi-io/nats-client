<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# client

```go
import "github.com/osapi-io/nats-client/pkg/client"
```

Package client provides a NATS JetStream client with connection management, KV stores, KV\-backed streams, and consumer helpers.

## Index

- [Variables](<#variables>)
- [type AuthOptions](<#AuthOptions>)
- [type AuthType](<#AuthType>)
- [type Client](<#Client>)
  - [func New\(logger \*slog.Logger, opts \*Options\) \*Client](<#New>)
  - [func \(c \*Client\) Connect\(\) error](<#Client.Connect>)
  - [func \(c \*Client\) ConsumeMessages\(ctx context.Context, streamName string, consumerName string, handler JetStreamMessageHandler, opts \*ConsumeOptions\) error](<#Client.ConsumeMessages>)
  - [func \(c \*Client\) CreateKVBucket\(bucketName string\) \(nats.KeyValue, error\)](<#Client.CreateKVBucket>)
  - [func \(c \*Client\) CreateKVBucketWithConfig\(config \*nats.KeyValueConfig\) \(nats.KeyValue, error\)](<#Client.CreateKVBucketWithConfig>)
  - [func \(c \*Client\) CreateOrUpdateConsumerWithConfig\(ctx context.Context, streamName string, consumerConfig jetstream.ConsumerConfig\) error](<#Client.CreateOrUpdateConsumerWithConfig>)
  - [func \(c \*Client\) CreateOrUpdateJetStreamWithConfig\(ctx context.Context, streamConfig \*nats.StreamConfig, consumerConfigs ...jetstream.ConsumerConfig\) error](<#Client.CreateOrUpdateJetStreamWithConfig>)
  - [func \(c \*Client\) CreateOrUpdateStreamWithConfig\(\_ context.Context, streamConfig \*nats.StreamConfig\) error](<#Client.CreateOrUpdateStreamWithConfig>)
  - [func \(c \*Client\) GetStreamInfo\(\_ context.Context, streamName string\) \(\*nats.StreamInfo, error\)](<#Client.GetStreamInfo>)
  - [func \(c \*Client\) KVDelete\(bucket string, key string\) error](<#Client.KVDelete>)
  - [func \(c \*Client\) KVGet\(bucket string, key string\) \(\[\]byte, error\)](<#Client.KVGet>)
  - [func \(c \*Client\) KVKeys\(bucket string\) \(\[\]string, error\)](<#Client.KVKeys>)
  - [func \(c \*Client\) KVPut\(bucket string, key string, value \[\]byte\) error](<#Client.KVPut>)
  - [func \(c \*Client\) KVPutAndPublish\(ctx context.Context, kvBucket string, key string, data \[\]byte, notifySubject string\) \(uint64, error\)](<#Client.KVPutAndPublish>)
  - [func \(c \*Client\) Publish\(ctx context.Context, subject string, data \[\]byte\) error](<#Client.Publish>)
  - [func \(c \*Client\) PublishAndWaitKV\(ctx context.Context, subject string, data \[\]byte, kvBucket nats.KeyValue, opts \*RequestReplyOptions\) \(\[\]byte, error\)](<#Client.PublishAndWaitKV>)
  - [func \(c \*Client\) WatchKV\(ctx context.Context, kv nats.KeyValue, pattern string\) \(\<\-chan nats.KeyValueEntry, error\)](<#Client.WatchKV>)
- [type ConsumeOptions](<#ConsumeOptions>)
- [type JetStreamMessageHandler](<#JetStreamMessageHandler>)
- [type NATSConnWrapper](<#NATSConnWrapper>)
  - [func \(n \*NATSConnWrapper\) Close\(\)](<#NATSConnWrapper.Close>)
  - [func \(n \*NATSConnWrapper\) Connect\(url string, opts ...nats.Option\) \(\*nats.Conn, error\)](<#NATSConnWrapper.Connect>)
  - [func \(n \*NATSConnWrapper\) ConnectedUrl\(\) string](<#NATSConnWrapper.ConnectedUrl>)
  - [func \(n \*NATSConnWrapper\) JetStream\(opts ...nats.JSOpt\) \(nats.JetStreamContext, error\)](<#NATSConnWrapper.JetStream>)
  - [func \(n \*NATSConnWrapper\) QueueSubscribe\(subject, queue string, handler nats.MsgHandler\) \(\*nats.Subscription, error\)](<#NATSConnWrapper.QueueSubscribe>)
  - [func \(n \*NATSConnWrapper\) Subscribe\(subject string, handler nats.MsgHandler\) \(\*nats.Subscription, error\)](<#NATSConnWrapper.Subscribe>)
- [type NATSConnector](<#NATSConnector>)
- [type Options](<#Options>)
- [type RequestReplyOptions](<#RequestReplyOptions>)


## Variables

<a name="GetJetStream"></a>GetJetStream is a public variable function wrapping jetstream.New.

```go
var GetJetStream = func(nc *nats.Conn) (jetstream.JetStream, error) {
    return jetstream.New(nc)
}
```

<a name="AuthOptions"></a>
## type AuthOptions

AuthOptions holds authentication\-related settings for connecting to NATS.

```go
type AuthOptions struct {
    // AuthType specifies the authentication method to use (NoAuth, UserPassAuth, or NKeyAuth).
    AuthType AuthType
    // Username is required for UserPassAuth and represents the NATS username.
    Username string
    // Password is required for UserPassAuth and represents the NATS password.
    Password string
    // NKeyFile is required for NKeyAuth and specifies the path to the NKEY private seed file.
    // This file should contain an Ed25519 private key (starting with "S").
    NKeyFile string
}
```

<a name="AuthType"></a>
## type AuthType

AuthType defines the different authentication methods supported by the client.

```go
type AuthType int
```

<a name="NoAuth"></a>

```go
const (
    // NoAuth represents a connection with no authentication.
    NoAuth AuthType = iota
    // UserPassAuth represents authentication using a username and password.
    UserPassAuth
    // NKeyAuth represents authentication using NATS NKEYs (Ed25519 public-private key pairs).
    NKeyAuth
)
```

<a name="Client"></a>
## type Client

Client provides an implementation for interacting with an embedded NATS server.

```go
type Client struct {

    // NC underlying connection.
    NC  NATSConnector
    // NativeJS is the native JetStream context used for provisioning streams and consumers.
    NativeJS nats.JetStreamContext
    // ExtJS is the extended JetStream API for high-level operations (e.g. retrieving streams/consumers).
    ExtJS jetstream.JetStream
    // Opts configuration options used to create the client
    Opts *Options
    // KeyPair allows injecting a mock `nkeys.KeyPair` for testing authentication logic.
    KeyPair nkeys.KeyPair
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func New

```go
func New(logger *slog.Logger, opts *Options) *Client
```

New creates a new Client instance using the provided logger and Options.

<a name="Client.Connect"></a>
### func \(\*Client\) Connect

```go
func (c *Client) Connect() error
```

Connect establishes the connection to the NATS server and JetStream context. This method returns an error if there are any issues during connection.

<a name="Client.ConsumeMessages"></a>
### func \(\*Client\) ConsumeMessages

```go
func (c *Client) ConsumeMessages(ctx context.Context, streamName string, consumerName string, handler JetStreamMessageHandler, opts *ConsumeOptions) error
```

ConsumeMessages subscribes to a JetStream consumer and processes messages with the provided handler. This provides a clean abstraction for message consumption with proper context handling.

<a name="Client.CreateKVBucket"></a>
### func \(\*Client\) CreateKVBucket

```go
func (c *Client) CreateKVBucket(bucketName string) (nats.KeyValue, error)
```

CreateKVBucket ensures a KV bucket exists and returns the KeyValue interface.

<a name="Client.CreateKVBucketWithConfig"></a>
### func \(\*Client\) CreateKVBucketWithConfig

```go
func (c *Client) CreateKVBucketWithConfig(config *nats.KeyValueConfig) (nats.KeyValue, error)
```

CreateKVBucketWithConfig ensures a KV bucket exists with the provided configuration and returns the KeyValue interface.

<a name="Client.CreateOrUpdateConsumerWithConfig"></a>
### func \(\*Client\) CreateOrUpdateConsumerWithConfig

```go
func (c *Client) CreateOrUpdateConsumerWithConfig(ctx context.Context, streamName string, consumerConfig jetstream.ConsumerConfig) error
```

CreateOrUpdateConsumerWithConfig creates or updates a JetStream consumer with the provided configuration.

<a name="Client.CreateOrUpdateJetStreamWithConfig"></a>
### func \(\*Client\) CreateOrUpdateJetStreamWithConfig

```go
func (c *Client) CreateOrUpdateJetStreamWithConfig(ctx context.Context, streamConfig *nats.StreamConfig, consumerConfigs ...jetstream.ConsumerConfig) error
```

CreateOrUpdateJetStreamWithConfig configures a JetStream stream and its consumers. This is a convenience method that creates both stream and consumers in one call.

<a name="Client.CreateOrUpdateStreamWithConfig"></a>
### func \(\*Client\) CreateOrUpdateStreamWithConfig

```go
func (c *Client) CreateOrUpdateStreamWithConfig(_ context.Context, streamConfig *nats.StreamConfig) error
```

CreateOrUpdateStreamWithConfig creates or updates a JetStream stream with the provided configuration.

<a name="Client.GetStreamInfo"></a>
### func \(\*Client\) GetStreamInfo

```go
func (c *Client) GetStreamInfo(_ context.Context, streamName string) (*nats.StreamInfo, error)
```

GetStreamInfo retrieves information about a JetStream stream.

<a name="Client.KVDelete"></a>
### func \(\*Client\) KVDelete

```go
func (c *Client) KVDelete(bucket string, key string) error
```

KVDelete removes a key from the specified KV bucket.

<a name="Client.KVGet"></a>
### func \(\*Client\) KVGet

```go
func (c *Client) KVGet(bucket string, key string) ([]byte, error)
```

KVGet retrieves a value from the specified KV bucket.

<a name="Client.KVKeys"></a>
### func \(\*Client\) KVKeys

```go
func (c *Client) KVKeys(bucket string) ([]string, error)
```

KVKeys returns all keys from the specified KV bucket.

<a name="Client.KVPut"></a>
### func \(\*Client\) KVPut

```go
func (c *Client) KVPut(bucket string, key string, value []byte) error
```

KVPut stores a value in the specified KV bucket.

<a name="Client.KVPutAndPublish"></a>
### func \(\*Client\) KVPutAndPublish

```go
func (c *Client) KVPutAndPublish(ctx context.Context, kvBucket string, key string, data []byte, notifySubject string) (uint64, error)
```

KVPutAndPublish implements the pattern of storing data in KV and sending a notification via stream. This is useful for workflow systems where you want persistent storage \+ event notification.

<a name="Client.Publish"></a>
### func \(\*Client\) Publish

```go
func (c *Client) Publish(ctx context.Context, subject string, data []byte) error
```

Publish publishes a message to a JetStream subject.

<a name="Client.PublishAndWaitKV"></a>
### func \(\*Client\) PublishAndWaitKV

```go
func (c *Client) PublishAndWaitKV(ctx context.Context, subject string, data []byte, kvBucket nats.KeyValue, opts *RequestReplyOptions) ([]byte, error)
```

PublishAndWaitKV publishes a message and waits for a response in a KV bucket. This implements an async request/reply pattern using KV for response storage.

<a name="Client.WatchKV"></a>
### func \(\*Client\) WatchKV

```go
func (c *Client) WatchKV(ctx context.Context, kv nats.KeyValue, pattern string) (<-chan nats.KeyValueEntry, error)
```

WatchKV watches a KV bucket for responses matching a pattern. This is useful for collecting responses from multiple workers.

Note: Test coverage for this function is intentionally limited to error paths and setup logic. The goroutine's event forwarding logic is not covered due to the complexity of testing async behavior without introducing flaky tests.

<a name="ConsumeOptions"></a>
## type ConsumeOptions

ConsumeOptions configures message consumption behavior.

```go
type ConsumeOptions struct {
    // QueueGroup for load balancing across multiple consumers (optional)
    QueueGroup string
    // MaxInFlight limits the number of unacknowledged messages
    MaxInFlight int
}
```

<a name="JetStreamMessageHandler"></a>
## type JetStreamMessageHandler

JetStreamMessageHandler defines the signature for JetStream message handling functions.

```go
type JetStreamMessageHandler func(msg jetstream.Msg) error
```

<a name="NATSConnWrapper"></a>
## type NATSConnWrapper

NATSConnWrapper is a concrete implementation of NATSConnector, wrapping a \*nats.Conn.

```go
type NATSConnWrapper struct {
    Conn *nats.Conn
}
```

<a name="NATSConnWrapper.Close"></a>
### func \(\*NATSConnWrapper\) Close

```go
func (n *NATSConnWrapper) Close()
```

Close wraps the Close method of nats.Conn.

<a name="NATSConnWrapper.Connect"></a>
### func \(\*NATSConnWrapper\) Connect

```go
func (n *NATSConnWrapper) Connect(url string, opts ...nats.Option) (*nats.Conn, error)
```

Connect establishes a connection to the NATS server with the given URL and options.

<a name="NATSConnWrapper.ConnectedUrl"></a>
### func \(\*NATSConnWrapper\) ConnectedUrl

```go
func (n *NATSConnWrapper) ConnectedUrl() string
```

ConnectedUrl wraps the ConnectedUrl method of nats.Conn.

<a name="NATSConnWrapper.JetStream"></a>
### func \(\*NATSConnWrapper\) JetStream

```go
func (n *NATSConnWrapper) JetStream(opts ...nats.JSOpt) (nats.JetStreamContext, error)
```

JetStream wraps the JetStream method of nats.Conn.

<a name="NATSConnWrapper.QueueSubscribe"></a>
### func \(\*NATSConnWrapper\) QueueSubscribe

```go
func (n *NATSConnWrapper) QueueSubscribe(subject, queue string, handler nats.MsgHandler) (*nats.Subscription, error)
```

QueueSubscribe wraps the QueueSubscribe method of nats.Conn.

<a name="NATSConnWrapper.Subscribe"></a>
### func \(\*NATSConnWrapper\) Subscribe

```go
func (n *NATSConnWrapper) Subscribe(subject string, handler nats.MsgHandler) (*nats.Subscription, error)
```

Subscribe wraps the Subscribe method of nats.Conn.

<a name="NATSConnector"></a>
## type NATSConnector

NATSConnector defines an interface for managing a NATS connection.

```go
type NATSConnector interface {
    JetStream(opts ...nats.JSOpt) (nats.JetStreamContext, error)
    Close()
    ConnectedUrl() string
    Connect(url string, opts ...nats.Option) (*nats.Conn, error)
    Subscribe(subject string, handler nats.MsgHandler) (*nats.Subscription, error)
    QueueSubscribe(subject, queue string, handler nats.MsgHandler) (*nats.Subscription, error)
}
```

<a name="Options"></a>
## type Options

Options holds the configuration for connecting to a NATS server, including connection details and authentication settings.

```go
type Options struct {
    // Host specifies the NATS server hostname or IP address.
    Host string
    // Port specifies the NATS server port.
    Port int
    // Auth contains authentication settings for connecting to the NATS server.
    Auth AuthOptions
    // Name is a human-readable name for this client connection.
    Name string
}
```

<a name="RequestReplyOptions"></a>
## type RequestReplyOptions

RequestReplyOptions configures request/reply behavior.

```go
type RequestReplyOptions struct {
    // RequestID to use (default: generated UUID)
    RequestID string
    // Timeout for waiting for response (default: 30s)
    Timeout time.Duration
    // PollInterval for checking KV store (default: 100ms)
    PollInterval time.Duration
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
